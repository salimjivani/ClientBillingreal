@{
    ViewBag.Title = "Home Page";
}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script>

    function $_GET(param) {
        var vars = {};
        window.location.href.replace(location.hash, '').replace(
            /[?&]+([^=&]+)=?([^&]*)?/gi, // regexp
            function (m, key, value) { // callback
                vars[key] = value !== undefined ? value : '';
            }
        );

        if (param) {
            return vars[param] ? vars[param] : null;
        }
        return vars;
    }

    var businesslogicsheet = Number($_GET('data'));

    var codemaint = [];



</script>
<button type='button' id='add' data-toggle='modal' data-target='#myModal' class='btn-success'>Add +</button>

<div class="container-fluid">
    <table class="table table-striped">
        <thead>
            <tr>
                <th></th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>



    <div id="codemaintinputs">
        <form method="post">
            <div id="codemaint"></div>
            <div id="businesslogicpagination">
                <ul class="pagination"></ul>
            </div>
            <button type="button" id="submitall">Submit</button>
        </form>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="myModal" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Modal Header</h4>
                </div>
                <form method="post" action="http://localhost:50008/?data=1">
                    <div class="modal-body modalbodyadd">
                        <table></table>
                    </div>
                    <div class="modal-footer">
                        <input type="submit" id="submitnew" class="btn btn-default" data-dismiss="modal" />
                    </div>
                </form>
            </div>

        </div>
    </div>

    <!--Edit Modal -->
    <div class="modal fade" id="editmyModal" role="dialog">
        <div class="modal-dialog">

            <!--Edit Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Modal Header</h4>
                </div>
                <form method="post" action="http://localhost:50008/?data=1">
                    <div class="modal-body modalbodyedit">
                        <table></table>
                    </div>
                    <div class="modal-footer">
                        <input type="submit" id="submitedit" class="submitedit btn btn-default" data-dismiss="modal" />
                    </div>
                </form>
            </div>

        </div>
    </div>


    </div>


<script>


    //$("#codemaint").ready(function () {
    $.ajax({
        url: "/Home/Businesslogicinputs",
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        async: false,
        type: "POST",
        data: "data",
        success: function (json) {
            console.log(json);
            codemaint = json;

            //Table Header
            for (x = 0; x < json[businesslogicsheet].Titles.length; x++)
            {
                $("table > thead > tr").append("<th>" + json[businesslogicsheet].Titles[x] + "</th>");
            }

            //Table Rows
            for (x = 0; x < json[businesslogicsheet].Details.length; x++)
            {
                $("table > tbody").append("<tr id=" + x + "><td><button class='edit' data-toggle='modal' data-target='#editmyModal' value=" + x + ">Edit</button></td></tr>");
                //Table Data
                for (y = 0; y < json[businesslogicsheet].BusinesslogicIDs.length; y++) {
                    $("#" + x).append("<td class='details" + y + "'>" + json[businesslogicsheet].Details[x].DetailModelValues[y].value + "</td>");
                }
            }
        },
        error: function () {
            $("#codemaint").html("ERROR");
        }
    });
    //}); -- end of function 

    //var panels = "<div id='mainpanel' class='panel panel-default'><div id='panelheading' class='panel-heading'>GLDatabase(11)</div><div id='panelbody' class='panel-body'><div id='panelnumber'></div></div></div>";
    //var panelbody = "<div id='col-md-4' class='col-md-4'><label>GL_Database</label><input type='text' /></div>";

    //Dynamically filling up input boxes
    //for (a = 0; a < codemaint.length; a++)
    //for (a = businesslogicsheet; a < businesslogicsheet + 1; a++)
    //{
    //    $("#codemaint").append($("<div class='panel panel-default mainpanel" + a + "'><div id='panelheading' class='panel-heading'>" + codemaint[a].Sheet + "<div class='pull-right'><button type='button' id='add' data-toggle='modal' data-target='#myModal' class='btn-success'>Add +</button></div></div><div id='panelbody" + a + "' class='panel-body panelbody" + a + "'><div id='panelnumber'></div></div></div>"));
    //    for (b = 0; b < codemaint[a].Details.length; b++)
    //    {
    //        $(".mainpanel" + a + "> #panelbody" + a).append($("<div class='row row" + b + "'></div><hr>"));
    //        for (c = 0; c < codemaint[a].Titles.length; c++)
    //        {
    //            $(".mainpanel" + a + "> #panelbody" + a + "> .row" + b).append($("<div class='col-md-4'><label>" + codemaint[a].Titles[c] + "</label><br><input type='text' class='inputs' value='" + codemaint[a].Details[b].DetailModelValues[c].value + "'/></div>"));
    //        }
    //    }
    //}

    //Dynamically filling up Pagination
    for (d = 0; d < codemaint.length; d++)
    {
        $(".pagination").append($("<li><a href='../?data=" + d + "'>" + codemaint[d].Sheet + "</a></li>"));
    }

    //Dynamically Fill Modal Overlay Inputs
    for (d = 0; d < codemaint[businesslogicsheet].Titles.length; d++)
    {
        $('form > .modalbodyadd > table').append($("<tr><td><label>" + codemaint[businesslogicsheet].Titles[d] + "</label></td><td><input class='newinputs inputs' type='text' value='testing" + d + "'/></td></tr>"));
    }

    //Dynamically Fill Edit Modal Overlay Inputs
    $(".edit").click(function () {
        var buttonvalue = $(this).val();
        $('form > .modalbodyedit > table').html('');
        $('.submitedit').attr("id", buttonvalue);
        for (x = 0; x < codemaint[businesslogicsheet].Details[buttonvalue].DetailModelValues.length; x++)
        {
            $('form > .modalbodyedit > table').append($("<tr><td><label>" + codemaint[businesslogicsheet].Titles[x] + "</label></td><td><input class='editinputs inputs' type='text' value='" + codemaint[businesslogicsheet].Details[buttonvalue].DetailModelValues[x].value + "'/></td></tr>"));
        }
    });

    //Submit Edit Modal
    $(".submitedit").click(function () { 
        var buttonvalue = $(this).attr("id");
        for (x = 0; x < codemaint[businesslogicsheet].Titles.length; x++)
        {
            codemaint[businesslogicsheet].Details[buttonvalue].DetailModelValues[x].value = document.getElementsByClassName("editinputs")[x].value;
            $("#" + buttonvalue + " > .details" + x).text(codemaint[businesslogicsheet].Details[buttonvalue].DetailModelValues[x].value);
        }
        console.log(codemaint);
        
    });

    //Adding new Items to Webpage
    $("#submitnew").click(function () {
        codemaint[businesslogicsheet].Details.push({ "DetailID": (codemaint[businesslogicsheet].Details.length + 1), "DetailModelValues": [] });

        var insertdetails = codemaint[businesslogicsheet].Details.length - 1;

        $(".mainpanel" + businesslogicsheet + "> #panelbody" + businesslogicsheet).append($("<div class='row row" + insertdetails + "'></div><hr>"));

        var insertrows = codemaint[businesslogicsheet].Details.length - 1;

        for (x = 0; x < codemaint[businesslogicsheet].Titles.length; x++)
        {
            codemaint[businesslogicsheet].Details[insertrows].DetailModelValues.push({ "value": document.getElementsByClassName("newinputs")[x].value });
            //$(".mainpanel" + businesslogicsheet + "> #panelbody" + businesslogicsheet + "> .row" + insertdetails).append($("<div class='col-md-4'><label>" + codemaint[businesslogicsheet].Titles[x] + "</label><br><input type='text' class='inputs' value='" + codemaint[businesslogicsheet].Details[insertrows].DetailModelValues[x].value  + "'/></div>"));   
        }
        $("table > tbody").append("<tr id=" + (codemaint[businesslogicsheet].Details.length - 1) + " value='hello'><td><button>Edit</button></td></tr>");

        for (x = 0; x < codemaint[businesslogicsheet].Details[(codemaint[businesslogicsheet].Details.length - 1)].DetailModelValues.length; x++)
        {
            $("#" + (codemaint[businesslogicsheet].Details.length - 1)).append("<td>" + codemaint[businesslogicsheet].Details[(codemaint[businesslogicsheet].Details.length - 1)].DetailModelValues[x].value + "</td>");
        }
    });

    //Send Data back to DB
    $("#submitall").click(function () {

        var z = 0;
        var InsertDetailsobj = [];
        for (x = 0; x < codemaint[businesslogicsheet].Details.length; x++) {
            for (y = 0; y < codemaint[businesslogicsheet].BusinesslogicIDs.length; y++) {
                //InsertDetailsobj.push({ "Numbers": x + 1, "BusinessLogicids": codemaint[businesslogicsheet].BusinesslogicIDs[y], "Values": document.getElementsByClassName("inputs")[z].value });
                InsertDetailsobj.push({ "Numbers": x + 1, "BusinessLogicids": codemaint[businesslogicsheet].BusinesslogicIDs[y], "Values": codemaint[businesslogicsheet].Details[x].DetailModelValues[y].value });
                z++;
            }
        }

        console.log(InsertDetailsobj);

        InsertDetailsobj = JSON.stringify({ 'InsertDetail': InsertDetailsobj });

        $.ajax({
            type: "POST",
            url: "Home/InsertBusinessLogic",
            data: InsertDetailsobj,
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (insertdata)
            {
                console.log(insertdata);
            },
            error: function () {
                console.log("ERROR");
            }
        }); 
    });
    

</script>